#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

Процедура ЗапуститьФормированиеСпискаДокументовПоКонтрагенту(ДополнительныеПараметры, АдресРезультата) Экспорт
	
	Запрос = Новый Запрос(ДополнительныеПараметры.ТекстЗапросаФильтрПолный);
	ОбщегоНазначенияКлиентСервер.ДополнитьСтруктуру(Запрос.Параметры, ДополнительныеПараметры.ПараметрыЗапроса);
	Запрос.МенеджерВременныхТаблиц  = Новый МенеджерВременныхТаблиц;
	
	УстановитьПривилегированныйРежим(Истина);
	Запрос.Выполнить();
	УстановитьПривилегированныйРежим(Ложь);

	Запрос.Текст = ДополнительныеПараметры.ТекстЗапросаПоДокументам;
	
	Результат = Запрос.Выполнить().Выгрузить();
	
	ПоместитьВоВременноеХранилище(Результат, АдресРезультата);
	
КонецПроцедуры

Процедура ГрупповоеПроведениеДокументов(ДополнительныеПараметры, АдресРезультата) Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("ИзмененоДокументов", 0);
	Результат.Вставить("ИзмененныеТипы", Новый Массив);
	
	Для каждого Документ Из ДополнительныеПараметры.ВыбранныеДокументы Цикл
		
		ДокументОбъект = Документ.ПолучитьОбъект();
		
		Попытка
			ДокументОбъект.Заблокировать();
			ДокументЗаполнен = ДокументОбъект.ПроверитьЗаполнение();
			Если НЕ ДокументЗаполнен Тогда
				ОбщегоНазначения.СообщитьПользователю(НСтр("ru='Ошибка заполнения документа.'"), Документ);
				Продолжить;
			КонецЕсли;
			ДокументОбъект.Записать(ДополнительныеПараметры.РежимЗаписи);
			
			Результат.ИзмененоДокументов = Результат.ИзмененоДокументов + 1;
			Тип = ТипЗнч(Документ);
			Если Результат.ИзмененныеТипы.Найти(Тип) = Неопределено Тогда
				Результат.ИзмененныеТипы.Добавить(Тип);
			КонецЕсли;
		Исключение
			ОбщегоНазначения.СообщитьПользователю(КраткоеПредставлениеОшибки(ИнформацияОбОшибке()), Документ);
		КонецПопытки;
		
	КонецЦикла;
	
	ПоместитьВоВременноеХранилище(Результат, АдресРезультата);
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли